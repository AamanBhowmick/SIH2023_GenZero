{% extends "layout.html" %}

{% block body %}
    <div class="home_section">
        <div class="home_title_wrap">
            {% if lang == 'english' %}
            <p class="home_title eng">
                Do you have any Skin-eruptions (Pimple like Structures)?
            </p>
            <div class="lang_button_wrap">
                <a class="lang_button" href="/question/spots/english/1">Yes</a>
                <a class="lang_button" href="/question/spots/english/0">No</a>
            </div>
            {% else %}
            <p class="home_title eng">
                क्या आपकी त्वचा पर कोई दाने (मुँहासे जैसी संरचनाएँ) हैं?
            </p>
            <div class="lang_button_wrap">
                <a class="lang_button" href="/question/spots/hindi/1">हाँ</a>
                <a class="lang_button" href="/question/spots/hindi/0">नहीं</a>
            </div>
            {% endif %}
            <input type="text" hidden id="language" value="{{ lang }}">
        </div>
    </div>

    <script>
        function executeAnnyang() {
            if (annyang) {
                const commands = {
                    'yes': () => { window.location.href = '/question/spots/english/1'; },
                    'no': () => { window.location.href = '/question/spots/english/0'; }
                };
                annyang.addCommands(commands);

                annyang.start();

                const listeningTimeout = 10000; 
                setTimeout(function() {
                    annyang.abort(); 
                }, listeningTimeout);
            }
        }

        function executeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'hi-IN';
        
                recognition.onresult = function(event) {
                    const result = event.results[0][0].transcript.toLowerCase();
        
                    if (result === 'हाँ' || result === 'हां') {
                        window.location.href = '/question/spots/hindi/1';
                    } else if (result === 'नहीं') {
                        window.location.href = '/question/spots/hindi/0';
                    }
                };
        
                recognition.start();
        
                const listeningTimeout = 10000;
                setTimeout(function() {
                    recognition.stop();
                }, listeningTimeout);
            }
        }

        window.addEventListener('load', function() {
            var xhr = new XMLHttpRequest();
            var language_ans = document.getElementById('language').value;
            console.log(language_ans)
            if(language_ans == "english"){
                xhr.open('POST', '/question/audio/erupt/eng_audio', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('Audio played');

                        executeAnnyang();
                    }
                };
                xhr.send();
            }
            else{
                xhr.open('POST', '/question/audio/erupt/hin_audio', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('Audio played');

                        executeSpeechRecognition();
                    }
                };
                xhr.send();
            }
        });
    </script>
{% endblock %}